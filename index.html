<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pパチンコシミュレーター エヴァ15風</title>
    <style>
        body { background: #121212; color: white; font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 200px; background: #1e1e1e; border-right: 2px solid #333; padding: 20px; flex-shrink: 0; }
        .machine-list { list-style: none; padding: 0; }
        .machine-item { padding: 10px; background: #333; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #7b2cbf; font-size: 0.9rem; }

        .main-content { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .machine { width: 100%; max-width: 450px; background: #2a2a2a; border: 4px solid #444; border-radius: 30px; padding: 25px; box-shadow: 0 0 30px rgba(0,0,0,0.7); position: relative; }
        
        /* 液晶画面と演出 */
        .screen { background: #000; height: 250px; border-radius: 15px; border: 3px solid #555; display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 20px; position: relative; overflow: hidden; }
        #display { font-size: 4rem; font-weight: bold; z-index: 2; }
        
        /* 当たり演出用フラッシュ */
        .flash-overlay { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 1; display: none; }
        @keyframes rainbow { 0%{background:red;} 20%{background:yellow;} 40%{background:green;} 60%{background:blue;} 80%{background:purple;} 100%{background:red;} }
        .is-hitting { display: block; animation: rainbow 0.1s linear infinite; opacity: 0.5; }

        .mode-badge { position: absolute; top: 10px; left: 10px; padding: 5px 10px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; z-index: 2; }
        .mode-normal { background: #555; }
        .mode-st { background: #d00000; }
        .mode-jititan { background: #0077b6; }

        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-item { background: #1e1e1e; padding: 10px; border-radius: 8px; text-align: center; }
        .stat-val { display: block; font-size: 1.2rem; font-weight: bold; color: #7b2cbf; }

        /* ボタンデザイン */
        #btn { background: linear-gradient(135deg, #ff0000, #990000); color: white; border: none; padding: 20px; font-size: 1.5rem; border-radius: 50px; cursor: pointer; width: 100%; box-shadow: 0 5px #660000; font-weight: bold; }
        #btn.active { background: linear-gradient(135deg, #555, #222); box-shadow: none; transform: translateY(3px); }

        .log { width: 100%; max-width: 450px; height: 100px; background: #000; margin-top: 15px; padding: 10px; border-radius: 10px; font-size: 0.8rem; color: #0f0; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>機種選択</h3>
    <ul class="machine-list">
        <li class="machine-item">Pエヴァ15 未来への咆哮</li>
    </ul>
</div>

<div class="main-content">
    <div class="machine">
        <div class="screen" id="screen-box">
            <div id="flash" class="flash-overlay"></div>
            <div id="mode-badge" class="mode-badge mode-normal">通常モード</div>
            <div id="display">READY</div>
            <div id="sub-display" style="color:#aaa; font-size:0.9rem; margin-top:10px;">回転数: 0</div>
        </div>

        <div class="stat-grid">
            <div class="stat-item"><span id="hits" class="stat-val">0</span><span style="font-size:0.7rem">大当り</span></div>
            <div class="stat-item"><span id="rush-count" class="stat-val">0</span><span style="font-size:0.7rem">連チャン</span></div>
            <div class="stat-item"><span id="investment" class="stat-val">0</span><span style="font-size:0.7rem">投資(円)</span></div>
            <div class="stat-item"><span id="balance" class="stat-val">0</span><span style="font-size:0.7rem">収支(円)</span></div>
        </div>

        <button id="btn" onclick="toggleAuto()">オート開始</button>
    </div>
    <div class="log" id="log">--- 履歴 ---<br></div>
</div>

<script>
    const SPEC = { normal_prob: 319.7, st_prob: 99.4, st_taps: 163, jititan_taps: 100, st_rush_rate: 0.59, payout: 1500 };
    let totalCount = 0, currentCount = 0, hits = 0, rushCount = 0, investment = 0, totalReturn = 0;
    let mode = 'NORMAL', stRemaining = 0, isAuto = false, autoTimer = null;

    function toggleAuto() {
        if (isAuto) {
            stopAuto();
        } else {
            isAuto = true;
            document.getElementById('btn').innerText = "ストップ";
            document.getElementById('btn').classList.add('active');
            autoTimer = setInterval(play, 50); // 0.05秒ごとに1回転（超高速）
        }
    }

    function stopAuto() {
        isAuto = false;
        clearInterval(autoTimer);
        document.getElementById('btn').innerText = "オート開始";
        document.getElementById('btn').classList.remove('active');
    }

    function play() {
        investment += 20;
        totalCount++;
        currentCount++;
        
        let prob = (mode === 'ST') ? SPEC.st_prob : (mode === 'JITITAN' ? SPEC.normal_prob : SPEC.normal_prob);
        
        if (Math.random() < 1 / prob) {
            handleHit();
        } else {
            document.getElementById('display').innerText = Math.floor(Math.random() * 10);
            if (mode !== 'NORMAL') {
                stRemaining--;
                if (stRemaining <= 0) {
                    addLog(`${mode}スルー...`);
                    mode = 'NORMAL';
                    currentCount = 0;
                    rushCount = 0;
                }
            }
        }
        updateUI();
    }

    function handleHit() {
        stopAuto(); // 当たったら止まる
        hits++;
        totalReturn += SPEC.payout;
        
        // 当たり演出
        const display = document.getElementById('display');
        const flash = document.getElementById('flash');
        display.innerText = "V";
        display.style.color = "#ffeb3b";
        flash.classList.add('is-hitting');
        
        setTimeout(() => {
            flash.classList.remove('is-hitting');
            display.style.color = "white";
        }, 2000);

        if (mode === 'NORMAL') {
            if (Math.random() < SPEC.st_rush_rate) {
                mode = 'ST'; stRemaining = SPEC.st_taps; rushCount = 1;
                addLog(`${currentCount}回転: 大当り(ST突入!)`);
            } else {
                mode = 'JITITAN'; stRemaining = SPEC.jititan_taps;
                addLog(`${currentCount}回転: 大当り(時短)`);
            }
        } else {
            mode = 'ST'; stRemaining = SPEC.st_taps; rushCount++;
            addLog(`${currentCount}回転: ${rushCount}連目!`);
        }
        currentCount = 0;
    }

    function updateUI() {
        document.getElementById('hits').innerText = hits;
        document.getElementById('rush-count').innerText = rushCount;
        document.getElementById('investment').innerText = investment.toLocaleString();
        document.getElementById('balance').innerText = (totalReturn - investment).toLocaleString();
        document.getElementById('sub-display').innerText = (mode === 'NORMAL') ? `通常回転: ${currentCount}` : `残り: ${stRemaining}回`;
        const badge = document.getElementById('mode-badge');
        badge.innerText = (mode === 'ST') ? "IMPACT RUSH" : (mode === 'JITITAN') ? "チャンスタイム" : "通常モード";
        badge.className = `mode-badge mode-${mode.toLowerCase()}`;
    }

    function addLog(msg) {
        const log = document.getElementById('log');
        log.innerHTML = `> ${msg}<br>` + log.innerHTML;
    }
</script>
</body>
</html>
