<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EVANGELION Sim -Hybrid Final-</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho+B1:wght@800&display=swap');
        body { background: #000; color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        header { width: 100%; height: 50px; background: #111; border-bottom: 2px solid #8a2be2; display: flex; align-items: center; padding: 0 10px; box-sizing: border-box; gap: 8px; position: sticky; top: 0; z-index: 100; }
        .header-btn { background: #333; color: #ccc; border: 1px solid #555; padding: 5px 8px; font-size: 0.7rem; cursor: pointer; border-radius: 4px; white-space: nowrap; }
        .btn-graph { background: #8a2be2; color: white; border-color: #a450ff; }
        .max-hamari-display { background: #000; color: #ff4444; border: 1px solid #ff4444; padding: 4px 8px; font-size: 0.75rem; border-radius: 4px; cursor: pointer; font-weight: bold; overflow: hidden; text-overflow: ellipsis; }
        .main-content { width: 100%; max-width: 440px; display: flex; flex-direction: column; align-items: center; padding: 10px; box-sizing: border-box; }
        .machine { width: 100%; background: #111; border: 3px solid #8a2be2; border-radius: 15px; padding: 12px; position: relative; box-sizing: border-box; transition: border-color 0.2s, box-shadow 0.2s; }
        .screen { background: #000; height: 300px; border-radius: 10px; border: 2px solid #444; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; width: 100%; }
        .digit-container { display: flex; gap: 5px; }
        .digit { font-size: 8.5rem; font-weight: 900; font-family: 'Shippori Mincho B1', serif; width: 110px; text-align: center; } 
        .mode-display { position: absolute; bottom: 35px; right: 15px; color: #8a2be2; font-weight: bold; font-size: 0.9rem; text-shadow: 0 0 5px #000; background: rgba(0,0,0,0.5); padding: 2px 6px; border-radius: 3px; border-right: 3px solid #8a2be2; text-align: right; min-width: 90px; }
        .gold { color: #ffeb3b; text-shadow: 0 0 30px #ffeb3b; }
        .odd { color: #ff4444; text-shadow: 0 0 20px #ff4444; }
        .even { color: #4444ff; text-shadow: 0 0 20px #4444ff; }
        .hidden-lamp { position: absolute; top: 12px; right: 20px; width: 15px; height: 15px; background: #222; border-radius: 50%; border: 1px solid #444; z-index: 10; }
        .lamp-active { animation: rainbow-bg 0.3s infinite; box-shadow: 0 0 20px #fff; }
        @keyframes rainbow-bg { 0% { background: #f00; } 20% { background: #ff0; } 40% { background: #0f0; } 60% { background: #0ff; } 80% { background: #00f; } 100% { background: #f0f; } }
        .vibrate { animation: vibration 0.05s infinite; }
        @keyframes vibration { 0% { transform: translate(0,0); } 25% { transform: translate(-2px, 2px); } 50% { transform: translate(2px, -2px); } 75% { transform: translate(-2px, -2px); } 100% { transform: translate(0,0); } }
        .flash-active { animation: flash-white 0.05s 20; }
        @keyframes flash-white { 0%, 100% { background: #000; } 50% { background: #fff; } }
        
        /* 保留デザイン */
        .heso-overlay { position: absolute; bottom: 10px; display: flex; align-items: center; gap: 8px; transition: all 0.3s; }
        .heso-ball { width: 10px; height: 10px; background: #222; border-radius: 50%; border: 1px solid #555; transition: all 0.2s; }
        /* 右打ち中（ST/時短）の形状変更 */
        .heso-overlay.right-mode { bottom: 80px; right: 10px; flex-direction: column-reverse; gap: 4px; }
        .heso-overlay.right-mode .heso-ball { width: 18px; height: 6px; border-radius: 2px; }
        
        .heso-current { border-width: 2px !important; border-color: #fff !important; }
        .heso-on { background: #888; }
        .heso-red { background: radial-gradient(circle, #ff4444, #880000); box-shadow: 0 0 8px #ff0000; border-color: #f00; }
        .heso-green { background: radial-gradient(circle, #44ff44, #008800); box-shadow: 0 0 8px #00ff00; border-color: #0f0; }
        .heso-blue { background: radial-gradient(circle, #4444ff, #000088); box-shadow: 0 0 8px #0000ff; border-color: #00f; }
        .heso-rainbow { animation: rainbow-bg 0.5s infinite; box-shadow: 0 0 10px #fff; border-color: #fff; }
        .heso-vibe { animation: vibration 0.1s infinite !important; background: radial-gradient(circle, #fff, #8a2be2) !important; box-shadow: 0 0 10px #8a2be2; border-color: #fff !important; }
        
        .effect-text { position: absolute; color: white; font-weight: bold; font-size: 2.2rem; z-index: 5; text-shadow: 0 0 10px #000; background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 5px; display: none; text-align: center; }
        .stat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-top: 12px; }
        .stat-item { background: #000; border: 1px solid #333; padding: 5px 0; text-align: center; border-radius: 4px; }
        .stat-val { font-size: 1.2rem; font-weight: bold; font-family: monospace; } 
        .val-white { color: #ffffff; }
        .val-red { color: #ff4444; }
        .val-blue { color: #4444ff; }
        .stat-label { font-size: 0.55rem; color: #888; display: block; margin-bottom: 2px; }
        .control-panel { margin-top: 12px; display: flex; gap: 8px; width: 100%; height: 65px; }
        .side-btns { display: flex; flex-direction: column; gap: 4px; width: 55px; }
        .side-btn { flex: 1; background: #222; color: #666; border: 1px solid #444; font-size: 0.7rem; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .side-btn.active { background: #8a2be2; color: #fff; border-color: #a450ff; }
        .btn-auto { flex: 1; background: #8a2be2; color: white; border: 1px solid #a450ff; font-weight: bold; border-radius: 6px; cursor: pointer; font-size: 1rem; }
        .btn-stop { background: #444 !important; border-color: #666 !important; }
        .log { width: 100%; max-width: 440px; height: 350px; background: #000; margin-top: 10px; padding: 10px; font-size: 0.95rem; color: #ffffff; overflow-y: auto; border: 1px solid #333; font-family: monospace; box-sizing: border-box; line-height: 1.5; } 
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; }
        #modal-content { background: #111; border: 2px solid #8a2be2; width: 92%; max-width: 450px; padding: 15px; border-radius: 12px; overflow-y: auto; max-height: 90vh; }
        .graph-area { background: #000; height: 200px; margin-bottom: 20px; border: 1px solid #333; }
        @keyframes rainbow-border { 0% { border-color: #f00; box-shadow: 0 0 15px #f00; } 100% { border-color: #f0f; box-shadow: 0 0 15px #f0f; } }
    </style>
</head>
<body>
    <header>
        <button class="header-btn">機種選択</button>
        <button class="header-btn btn-graph" onclick="openModal()">データグラフ</button>
        <button class="header-btn" onclick="resetData()">リセット</button>
        <div id="max-hamari-box" class="max-hamari-display" onclick="showHamariDetail()">最大ハマリ: 0</div>
    </header>
    <div id="modal-overlay">
        <div id="modal-content">
            <span style="float:right; cursor:pointer; font-size:1.5rem;" onclick="closeModal()">×</span>
            <h3 style="font-size: 0.9rem; margin: 0 0 10px 0; color: #8a2be2;">差玉スランプグラフ</h3>
            <div class="graph-area"><canvas id="slumpChart"></canvas></div>
            <h3 style="font-size: 0.9rem; margin: 0 0 10px 0; color: #8a2be2;">大当り履歴（初当りハマリ）</h3>
            <div class="graph-area"><canvas id="historyChart"></canvas></div>
        </div>
    </div>
    <div class="main-content">
        <div class="machine" id="machine">
            <div id="lamp" class="hidden-lamp"></div>
            <div class="screen" id="screen">
                <div id="effect-overlay" class="effect-text"></div>
                <div class="digit-container">
                    <div id="d1" class="digit odd">3</div><div id="d2" class="digit odd">5</div><div id="d3" class="digit gold">7</div>
                </div>
                <div id="sub-display" class="mode-display">通常:0</div>
                <div id="heso-area" class="heso-overlay">
                    <div id="h0" class="heso-ball heso-current"></div>
                    <div id="h1" class="heso-ball"></div>
                    <div id="h2" class="heso-ball"></div>
                    <div id="h3" class="heso-ball"></div>
                    <div id="h4" class="heso-ball"></div>
                </div>
            </div>
            <div class="stat-grid">
                <div class="stat-item"><span class="stat-label">大当り</span><span id="hits" class="stat-val val-white">0</span></div>
                <div class="stat-item"><span class="stat-label">連チャン</span><span id="rush-count" class="stat-val val-white">0</span></div>
                <div class="stat-item"><span class="stat-label">現在回転</span><span id="current-rot" class="stat-val val-white">0</span></div>
                <div class="stat-item"><span class="stat-label">累計回転</span><span id="total-rot" class="stat-val val-white">0</span></div>
                <div class="stat-item"><span class="stat-label">差玉数</span><span id="balance" class="stat-val val-white">0</span></div>
            </div>
            <div class="control-panel">
                <div class="side-btns">
                    <button id="btn-all" class="side-btn" onclick="toggleOpt('all')">全</button>
                    <button id="btn-kokuchi" class="side-btn" onclick="toggleOpt('kokuchi')">告知</button>
                </div>
                <button class="btn-auto" id="btn-slow" onclick="toggleAuto('slow')">低速オート</button>
                <button class="btn-auto" id="btn-fast" onclick="toggleAuto('fast')">高速オート</button>
            </div>
        </div>
        <div class="log" id="log">> 保存を完了しました。</div>
    </div>

    
<script>
    // --- スペック・状態管理 ---
    const SPECS = { n: 319.7, s: 99.4, st: 163, jt: 100 };
    let hits = 0, rushCount = 0, currentRot = 0, totalRot = 0, totalBall = 0, currentRushHits = 0;
    let maxHamari = 0, mode = '通常', rRem = 0, isAuto = false, autoSpeed = 'slow', isAnim = false;
    let lcdCount = 0, optKokuchi = false, optAll = false, originalSpeedSetting = 'slow';
    let reservedStock = [], activeJob = null;
    
    // グラフ用データ（全履歴を保持するように修正）
    let slumpData = [0]; 
    let slumpLabels = ["0"]; 
    let historyData = []; 
    let historyLabels = [];
    let sChart, hChart;

    // --- 信頼度設定 ---
    const TRUST_MAP_N = { "白レバ": 0.90, "赤レバ": 0.965, "赤保留": 0.90, "次回予告": 0.65, "レイ背景": 0.85, "金系": 0.50, "カウントダウン": 0.88, "カヲル": 1.0, "レイ背景(さよなら)": 1.0 };
    const TRUST_MAP_S = { "白レバ": 0.95, "赤レバ": 0.99, "赤保留": 0.95, "次回予告": 1.0, "レイ背景": 0.92, "金系": 0.80, "カウントダウン": 0.88, "カヲル": 1.0 };

    window.onload = () => { initCharts(); updateUI(); };

    function getDigitClass(num) {
        if (num === 7) return mode === 'ST' ? 'digit gold' : 'digit odd';
        return num % 2 === 0 ? 'digit even' : 'digit odd';
    }

    function preCheck() {
        if (reservedStock.length >= 4) return;
        let isHit = Math.random() < (1 / (mode !== '通常' ? SPECS.s : SPECS.n));
        let holdType = "none", preVibe = "none", hasCountdown = false, isKaworu = false;
        
        if (isHit) {
            if (Math.random() < 0.05) hasCountdown = true;
            if (Math.random() < (mode === '通常' ? 0.02 : 0.05)) isKaworu = true;
            if (mode === '通常') {
                let hRoll = Math.random() * 100;
                if (hRoll < 33) holdType = "red";
                else if (hRoll < 45) { 
                    holdType = "vibe"; 
                    let vr = Math.random() * 100;
                    preVibe = vr < 50 ? "white" : (vr < 90 ? "red" : "rainbow");
                }
            } else {
                let hRoll = Math.random() * 100;
                if (hRoll < 25) holdType = "red";
                else if (hRoll < 40) { 
                    holdType = "vibe"; 
                    let vr = Math.random() * 100;
                    preVibe = vr < 60 ? "white" : (vr < 90 ? "red" : "rainbow");
                }
                else if (hRoll < 51) holdType = "rainbow";
            }
        } else {
            if (Math.random() < 0.0002) holdType = "red"; 
            if (Math.random() < 0.0001) hasCountdown = true; 
        }
        
        const isPreEffect = (holdType === "red" || holdType === "vibe" || holdType === "rainbow" || preVibe !== "none" || hasCountdown || isKaworu);
        if (isPreEffect && isAuto && autoSpeed === "fast") { autoSpeed = 'slow'; updateAutoBtns(); }

        reservedStock.push({ isHit: isHit, holdType: holdType, preVibe: preVibe, hasCountdown: hasCountdown, isKaworu: isKaworu });
        if (preVibe !== "none") triggerVibeUI(preVibe);
        updateHesoUI();
    }

    function selectEffect(job) {
        let res = { heavy: false, name: [], trust: 0, vibe: false, vibeColor: job.preVibe, flash: false, text: "", holdType: job.holdType, isSure: false, hasCountdown: job.hasCountdown, isKaworu: job.isKaworu };
        const map = (mode !== '通常') ? TRUST_MAP_S : TRUST_MAP_N;

        if (res.isKaworu) { res.name.push("カヲル"); res.isSure = true; res.text = "渚カヲル"; res.flash = true; }
        if (res.holdType === "rainbow") { res.name.push("虹保留"); res.isSure = true; }
        if (res.vibeColor === "rainbow") { res.name.push("虹レバ"); res.isSure = true; res.vibe = true; }

        if (job.isHit) {
            if (mode === '通常') {
                if (res.holdType === "red") res.name.push("赤保留");
                if (res.hasCountdown) res.name.push("カウントダウン");
                if (res.vibeColor === "white") { res.vibe = true; res.name.push("白レバ"); }
                if (res.vibeColor === "red") { res.vibe = true; res.name.push("赤レバ"); }
                if (!res.isKaworu) {
                    if (Math.random() < 0.40) { res.name.push("次回予告"); res.text="次回予告"; }
                    let rayRoll = Math.random();
                    if (rayRoll < 0.05) { res.name.push("レイ背景(さよなら)"); res.text="さよなら"; res.isSure = true; }
                    else if (rayRoll < 0.15) { res.name.push("レイ背景"); res.text="レイ背景"; }
                    if (Math.random() < 0.60) res.name.push("金系");
                }
            } else {
                if (res.holdType === "red") res.name.push("赤保留");
                if (res.vibeColor === "white") { res.vibe = true; res.name.push("白レバ"); }
                if (res.vibeColor === "red") { res.vibe = true; res.name.push("赤レバ"); }
                if (Math.random() < 0.33) res.name.push("金系"); 
                if (Math.random() < 0.10) { res.name.push("次回予告"); res.text="次回予告"; res.isSure = true; }
                if (res.name.length === 0 && Math.random() > 0.01) { res.name.push("金系"); }
            }
            res.heavy = true;
        } else {
            if (res.holdType === "red") res.name.push("赤保留");
            if (res.hasCountdown) res.name.push("カウントダウン");
            if (mode !== '通常') {
                if (Math.random() < 0.008) res.name.push("金系"); 
            } else {
                if (Math.random() < 0.02) { res.name.push("レイ背景"); res.text="レイ背景"; res.heavy = true; }
            }
        }

        res.name = [...new Set(res.name)];
        if (res.isSure) res.trust = 100; 
        else if (res.name.length > 0) {
            let fail = 1; res.name.forEach(n => { let t = map[n] || 0.05; fail *= (1 - t); });
            res.trust = (1 - fail) * 100;
        } else { res.trust = (mode === '通常' ? 0.1 : 1.0); }
        
        res.displayName = res.name.join("+") || (job.isHit ? "演出なし" : "弱予告");
        return res;
    }

    async function startProcess() {
        if(!isAuto || isAnim) return;
        if(mode !== '通常' && rRem <= 0) {
            let prev = mode;
            addLog(`【${prev}終了】 ${currentRushHits <= 1 ? (currentRushHits === 0 ? '0回' : '1回(' + prev + ')') : currentRushHits + '連'}`);
            mode = '通常'; currentRushHits = 0; lcdCount = 0;
            updateUI();
            if (prev === '時短' && originalSpeedSetting === 'fast') { autoSpeed = 'fast'; updateAutoBtns(); }
            else { isAuto = false; updateAutoBtns(); return; }
        }
        while(reservedStock.length < 1) preCheck();
        activeJob = reservedStock.shift();
        updateHesoUI();
        while(reservedStock.length < 4) preCheck();
        let eff = selectEffect(activeJob);
        if(optKokuchi && activeJob.isHit) { eff.flash=true; eff.isSure=true; eff.trust=100; eff.displayName="インフラ告知"; }
        
        totalRot++; currentRot++; lcdCount++; 
        if(mode !== '通常') { rRem--; totalBall -= 0.05; } else { totalBall -= (250 / 18); }
        
        // 1回転ごとにグラフ更新
        updateCharts();

        if (eff.hasCountdown) { for(let i=3; i>=1; i--) { addLog(`<span style="color:#f44; font-weight:bold;">●${i}...</span>`); await new Promise(r => setTimeout(r, 400)); } }
        if(eff.trust >= 50 || activeJob.isHit || eff.hasCountdown) {
            addLog(`${mode} ${lcdCount}回転【${eff.displayName}】信頼度:${eff.trust.toFixed(1)}%`);
            if(eff.vibe) triggerVibeUI(activeJob.preVibe);
            if(eff.flash) document.getElementById('lamp').classList.add('lamp-active');
            if(eff.text) { const ov = document.getElementById('effect-overlay'); ov.innerText = eff.text; ov.style.display = 'block'; }
        }
        let spinTime = (eff.heavy) ? 2500 : (autoSpeed === 'fast' ? 60 : 600);
        let spin = setInterval(() => { 
            let n1 = Math.floor(Math.random()*9)+1, n2 = Math.floor(Math.random()*9)+1, n3 = Math.floor(Math.random()*9)+1;
            if (mode === '通常' && !activeJob.isHit) { if(n1===7)n1=8; if(n2===7)n2=8; if(n3===7)n3=8; }
            const d1=document.getElementById('d1'), d2=document.getElementById('d2'), d3=document.getElementById('d3');
            d1.innerText=n1; d1.className = getDigitClass(n1); d2.innerText=n2; d2.className = getDigitClass(n2); d3.innerText=n3; d3.className = getDigitClass(n3);
        }, 40);
        await new Promise(r => setTimeout(r, spinTime));
        clearInterval(spin);
        document.getElementById('lamp').classList.remove('lamp-active');
        document.getElementById('effect-overlay').style.display = 'none';
        if(activeJob.isHit) {
            isAnim = true; hits++; 
            if(mode === '通常') { if(currentRot > maxHamari) { maxHamari = currentRot; document.getElementById('max-hamari-box').innerText = `最大ハマリ: ${maxHamari}`; } historyData.push(currentRot); historyLabels.push(hits + "回目"); }
            currentRot = 0;
            let rand = Math.random()*100, logDigit, isST = false, bonusText = "";
            if (mode !== '通常') { logDigit = (rand < 50) ? 7 : [1,3,5,9][Math.floor(Math.random()*4)]; isST = true; totalBall += 1400;
            } else {
                if (activeJob.isKaworu || activeJob.preVibe === "rainbow") { logDigit = [1,3,5,7,9][Math.floor(Math.random()*5)]; isST = true; totalBall += (logDigit === 7 ? 1400 : 420);
                } else if (rand < 2) { logDigit = 7; isST = true; totalBall += 1400; bonusText = "[全回転] ";
                } else if (rand < 5) { logDigit = 7; isST = true; totalBall += 1400;
                } else if (rand < 59) { logDigit = [1,3,5,9][Math.floor(Math.random()*4)]; isST = true; totalBall += 420;
                } else { logDigit = [2,4,6,8][Math.floor(Math.random()*4)]; isST = false; totalBall += 420; }
            }
            [1,2,3].forEach(i => { const el = document.getElementById('d'+i); el.innerText = logDigit; el.className = getDigitClass(logDigit); });
            await new Promise(r => setTimeout(r, 1500));
            if(isST) { mode = 'ST'; rRem = SPECS.st; rushCount++; } else { mode = '時短'; rRem = SPECS.jt; }
            addLog(`>> ${mode}突入 ${bonusText}【${logDigit}】 当り!`);
            currentRushHits++; updateUI(); await new Promise(r => setTimeout(r, 1500)); lcdCount = 0; reservedStock = []; activeJob = null;
        }
        isAnim = false;
        if(isAuto) autoSpeed = originalSpeedSetting;
        updateUI(); updateAutoBtns();
        if(isAuto) setTimeout(startProcess, (autoSpeed === 'fast' ? 5 : 300));
    }
    
    function toggleAuto(s) { if(isAuto && autoSpeed === s) { isAuto = false; } else { isAuto = true; autoSpeed = s; originalSpeedSetting = s; if(!isAnim) startProcess(); } updateAutoBtns(); }
    function updateAutoBtns() { document.getElementById('btn-slow').classList.remove('btn-stop'); document.getElementById('btn-fast').classList.remove('btn-stop'); if(isAuto) document.getElementById('btn-' + autoSpeed).classList.add('btn-stop'); }
    function toggleOpt(t) { if(t==='kokuchi') optKokuchi=!optKokuchi; if(t==='all') optAll=!optAll; document.getElementById('btn-'+t).classList.toggle('active'); }
    function updateHesoUI() { const hA = document.getElementById('heso-area'); if(mode !== '通常') hA.classList.add('right-mode'); else hA.classList.remove('right-mode'); for(let i=0; i<=4; i++) { const el = document.getElementById('h'+i); const s = (i===0) ? activeJob : reservedStock[i-1]; el.className = `heso-ball ${i===0?'heso-current':''}`; if(s) { if(s.isKaworu || s.preVibe === 'rainbow' || s.holdType === 'rainbow') el.classList.add('heso-rainbow'); else if(s.holdType !== 'none') el.classList.add('heso-' + s.holdType); else el.classList.add('heso-on'); } } }
    
    function updateUI() { 
        document.getElementById('hits').innerText = hits; 
        document.getElementById('rush-count').innerText = rushCount; 
        document.getElementById('current-rot').innerText = currentRot; 
        document.getElementById('total-rot').innerText = totalRot; 
        document.getElementById('balance').innerText = Math.floor(totalBall).toLocaleString(); 
        document.getElementById('sub-display').innerText = mode==='通常' ? `通常:${lcdCount}` : `${mode}:${rRem}`; 
        updateHesoUI(); 
    }

    function addLog(m) { const l = document.getElementById('log'); l.innerHTML = `> ${m}<br>${l.innerHTML}`; }
    function triggerVibeUI(c) { const m = document.getElementById('machine'); m.classList.add('vibrate'); setTimeout(()=>{ m.classList.remove('vibrate'); }, 500); }

    function initCharts() { 
        const ctxS = document.getElementById('slumpChart').getContext('2d'); 
        sChart = new Chart(ctxS, { 
            type: 'line', 
            data: { 
                labels: slumpLabels, 
                datasets: [{ label: '差玉', data: slumpData, borderColor: '#8a2be2', borderWidth: 2, fill: false, pointRadius: 0 }] 
            }, 
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                scales: { x: { display: true, title: { display: true, text: 'トータル回転数' } } }
            } 
        }); 
        const ctxH = document.getElementById('historyChart').getContext('2d'); 
        hChart = new Chart(ctxH, { type: 'bar', data: { labels: historyLabels, datasets: [{ label: 'ハマリ', data: historyData, backgroundColor: '#ff4444' }] }, options: { responsive: true, maintainAspectRatio: false } }); 
    }

    function updateCharts() { 
        slumpData.push(totalBall); 
        slumpLabels.push(totalRot.toString()); 
        // データの制限を撤廃し、開始時からの全推移を表示
        sChart.update('none'); // アニメーションなしで更新（負荷軽減）
        hChart.update(); 
    }

    function openModal() { document.getElementById('modal-overlay').style.display='flex'; }
    function closeModal() { document.getElementById('modal-overlay').style.display='none'; }
    function resetData() { if(confirm('データをリセットしますか？')) location.reload(); }
</script>
</body>
</html>
























































































